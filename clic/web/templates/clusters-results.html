{% extends "layout/default.html" %}

{% set active_page = 'clusters' %}

{% block stylesheets %}
  {{ super() }}

  <link href="/js/thirdparty/DataTables1.10.0-beta.2/media/css/dataTables.bootstrap.css" rel="stylesheet">
  <link href="/js/thirdparty/pace-0.5.1/themes/pace-theme-center-circle-uon.css" rel="stylesheet"/>
{% endblock %}

{% block title %}
    Clusters {{ super() }}
{% endblock %}

{% block main_body %}
  <h2 class="without-pills">Clusters Results</h2>

  <div id="resultsWrap">
    <div id="tableContainer">
    <table style="width: 0px; cursor:pointer" aria-describedby="dataTableClusters_info" class="table table-striped table-hover dataTable no-footer uonDatatable" id="dataTableClusters">
        <thead>
            <tr role="row">
                <th aria-label="No" style="width: 0px;" colspan="1" rowspan="1" class="sorting_asc">No</th>
                <th aria-label="n-gram: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableClusters" tabindex="0" class="sorting">n-gram</th>
                <th aria-label="Freq: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableClusters" tabindex="0" class="sorting">Freq</th>
                <th aria-label="%: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableClusters" tabindex="0" class="sorting">%</th>
            </tr>
        </thead>
        <tbody>
        {% for cluster in clusters %}
            <tr class="{{ loop.cycle('odd', 'even') }}"><td class="sorting_1">{{ loop.index }}</td><td>{{ cluster[1] }}</td><td>{{ cluster[2] }}</td><td>{{ cluster[3] }}</td></tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}

  <script src='/js/thirdparty/pace-0.5.1/pace.min.js'></script>

  <script src="/js/thirdparty/DataTables1.10.0-beta.2/media/js/jquery.dataTables.min.js"></script>
  <script src="/js/thirdparty/DataTables1.10.0-beta.2/extensions/TableTools/js/dataTables.tableTools.min.js"></script>
  <!-- datatables bootstrap js (css is above) see http://next.datatables.net/manual/styling/bootstrap -->
  <script src="/js/thirdparty/DataTables1.10.0-beta.2/media/js/dataTables.bootstrap.js"></script>

  <script>
      $(function () {

          var oTable = $('#dataTableClusters').dataTable({

              "aoColumns": [
                  { "sTitle": "No" },
                  { "sTitle": "n-gram" },
                  { "sTitle": "Freq" },
                  { "sTitle": "%" }
              ],

              "fnInitComplete": function () {
                $('#resultsWrap').show();
                Pace.stop();
              },

              "bDeferRender": true,
              "bPaginate": false,
              <!--  I think it makes more sense to use pseudo-pagination: -->
              <!-- "bPaginate": true, -->
              <!-- "aLengthMenu": [[5, 10, 15, 25, 50, 100, -1], [5, 10, 15, 25, 50, 100, "All"]], -->
              <!-- "iDisplayLength" : 50, -->

              "bLengthChange": false,
              "bFilter": true,
              "bSort": true,
              "aoColumnDefs": [
                  { "bSortable": false, "aTargets": [ 0 ] },
                  { "bSearchable": false, "aTargets": [0,2,3] }
              ],
              // change phrase on search box
              "oLanguage": {
                  "sSearch": "Filter n-gram:"
              },
              "oTableTools": {
                  "aButtons": [ "csv", "print" ],
                  "sSwfPath": "/js/thirdparty/DataTables1.10.0-beta.2/extensions/TableTools/swf/copy_csv_xls.swf"
              },
              // duplicate controls iflp
              "sDom": '<iTf>rt<if>'
          });


         // this is a quick, tmp solution, we should use awesome-slugify and a template filter instead
        function slugify(text)
            {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '+')           // Replace spaces with +
            }
            //    .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
            //    .replace(/\-\-+/g, '-')         // Replace multiple - with single -
            //    .replace(/^-+/, '')             // Trim - from start of text
            //    .replace(/-+$/, '');            // Trim - from end of text
            //}

          $('#dataTableClusters tbody').on('click', 'tr', function () {
              var data = oTable.fnGetData(this);
              var term = data[1]
              var slug = slugify(term)
              window.location.href = '/concordances/?terms=' + slug + "&testCollection={{testCollection}}&testIdxMod={{testIdxMod}}&selectWords={{selectWords}}";
          });
      });

  </script>

{% endblock %}
