{% extends "layout/default.html" %}

{% set active_page = 'keywords' %}

{% block stylesheets %}
  {{ super() }}

  <link href="/js/thirdparty/DataTables1.10.0-beta.2/media/css/dataTables.bootstrap.css" rel="stylesheet">
  <link href="/js/thirdparty/pace-0.5.1/themes/pace-theme-center-circle-uon.css" rel="stylesheet"/>
{% endblock %}

{% block title %}
    Keywords {{ super() }}
{% endblock %}

{% block main_body %}
  <h2 class="without-pills">Keywords Results</h2>

  <div id="resultsWrap">
    <div id="tableContainer">
       <table style="width: 100%; cursor:pointer;" aria-describedby="dataTableKeywords_info" class="table table-striped table-hover dataTable no-footer uonDatatable" id="dataTableKeywords">
         <thead>
            <tr role="row">
              <th aria-label="No" style="width: 0px;" colspan="1" rowspan="1" class="sorting_asc">No</th>
              <th aria-label="n-gram: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="nowrap sorting">N-gram</th>
              <th aria-label="Target Freq: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="nowrap sorting">Target Freq</th>
              <th aria-label="Ref Freq: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="nowrap sorting">Ref Freq</th>
              <th aria-label="%: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="sorting">Expected target</th>
              <th aria-label="%: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="sorting">Expected ref</th>
              <th aria-label="LL: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="sorting">LL</th>
              <th aria-label="P: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="sorting">P</th>
              <th aria-label="Overused or underused: activate to sort column ascending" style="width: 0px;" colspan="1" rowspan="1" aria-controls="dataTableKeywords" tabindex="0" class="sorting">Overused or underused</th>            </tr>
         </thead>
        <tbody>
        {% for keyword in keywords.to_records() %}
            <tr class="{{ loop.cycle('odd', 'even') }}">
                <td class="sorting_1">{{ loop.index }}</td>
                <td>{{ keyword['Type'] }}</td>
                <td>{{ keyword['Count_analysis'] }}</td>
                <td>{{ keyword['Count_ref'] }}</td>
                <td>{{ keyword['Expected_count_analysis'] }}</td>
                <td>{{ keyword['Expected_count_ref'] }}</td>
                <td>{{ keyword['LL'] }}</td>
                <td>{{ keyword['p'] }}</td>
                <td>{{ keyword['Use'] }}</td>            
            </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}

  <script src='/js/thirdparty/pace-0.5.1/pace.min.js'></script>

  <script src="/js/thirdparty/DataTables1.10.0-beta.2/media/js/jquery.dataTables.min.js"></script>
  <script src="/js/thirdparty/DataTables1.10.0-beta.2/extensions/TableTools/js/dataTables.tableTools.min.js"></script>
  <!-- datatables bootstrap js (css is above) see http://next.datatables.net/manual/styling/bootstrap -->
  <script src="/js/thirdparty/DataTables1.10.0-beta.2/media/js/dataTables.bootstrap.js"></script>

  <script>
    $(function () {

        var oTable = $('#dataTableKeywords').dataTable({

            "fnInitComplete": function () {
                $('#resultsWrap').show();
                Pace.stop();
            },

            "aoColumns": [
                { "sTitle": "No" },
                { "sTitle": "N-gram" ,   "sClass": "nowrap" },
                { "sTitle": "Target Frequency", "sClass": "nowrap" },
                { "sTitle": "Ref Frequency" , "sClass": "nowrap" },
                { "sTitle": "Expected target" },
                { "sTitle": "Expected ref" },
                { "sTitle": "LL" },
                { "sTitle": "P" },
                { "sTitle": "Overused or underused"}
            ],
            "aoColumnDefs": [
                // { "bSortable": false, "aTargets": [ 0 ] },
                { "bSearchable": false, "aTargets": [0, 2, 3, 4, 5, 6, 7] }
            ],

            "bDeferRender": true,
            "bPaginate": false,
            "bSort": true,
            "bFilter": true,

            "oTableTools": {
                "aButtons": [ "csv", "print" ],
                "sSwfPath": "/js/thirdparty/DataTables1.10.0-beta.2/extensions/TableTools/swf/copy_csv_xls.swf"
            },

            // change phrase on search box
            "oLanguage": {
                "sSearch": "Filter n-gram:"
            },
            // duplicate controls iflp
            "sDom": '<"toolbar"iTf>rt<"toolbar"if>'
        });

         // this is a quick, tmp solution, we should use awesome-slugify and a template filter instead
        function slugify(text)
            {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '+')           // Replace spaces with +
            }
            //    .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
            //    .replace(/\-\-+/g, '-')         // Replace multiple - with single -
            //    .replace(/^-+/, '')             // Trim - from start of text
            //    .replace(/-+$/, '');            // Trim - from end of text
            //}

          $('#dataTableKeywords tbody').on('click', 'tr', function () {
              var data = oTable.fnGetData(this);
              var term = data[1]
              var slug = slugify(term)
              window.location.href = '/concordances/?terms=' + slug + "&testCollection={{subcorpora_analysis}}&testIdxMod={{subset}}&selectWords={{selectWords}}";
          });
     });
</script>

{% endblock %}
